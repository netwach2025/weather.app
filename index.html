<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NetWatch Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    /* =========================================
       NETWATCH PRO: RESPONSIVE ENGINE
       ========================================= */
    :root {
      --bg-deep: #000000;
      --accent: #a5f3fc;
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.6);
      
      --glass-surface: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.18);
      --glass-highlight: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      
      --radius-lg: 32px;
      --radius-pill: 999px;
      --sidebar-width: 88px;
      
      /* Safe Area Variables for iPhone Notch/Home Bar */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; width: 100vw; height: 100vh;
      background: #000;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }

    /* ===== BACKGROUND ===== */
    .app-bg {
      position: fixed; inset: 0; z-index: -2;
      background: radial-gradient(circle at 50% 0%, #1e1b4b, #0f172a, #000);
      transition: background 2s ease;
    }
    .app-noise {
      position: fixed; inset: 0; z-index: -1; opacity: 0.07; pointer-events: none;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJuIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC44IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI24pIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=');
    }

    .app-container { display: flex; height: 100vh; width: 100vw; }

    /* ===== RESPONSIVE SIDEBAR / BOTTOM NAV ===== */
    .sidebar {
      width: var(--sidebar-width); height: 100%;
      background: rgba(10, 10, 10, 0.4);
      backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
      border-right: 1px solid var(--glass-border);
      display: flex; flex-direction: column; align-items: center;
      padding: 2.5rem 0; gap: 1.5rem; z-index: 100;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-logo { font-size: 2rem; color: var(--accent); margin-bottom: 2rem; filter: drop-shadow(0 0 15px rgba(34,211,238,0.6)); }

    .nav-item {
      position: relative; width: 56px; height: 56px;
      border-radius: 20px; display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); font-size: 1.6rem; cursor: pointer;
      border: none; background: transparent; transition: all 0.2s;
    }
    .nav-item:hover, .nav-item.active {
      color: #fff; background: rgba(255,255,255,0.1);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }
    .nav-item.active i { color: var(--accent); }
    
    /* Mobile-Only Nav Adjustments */
    @media (max-width: 768px) {
      .app-container { flex-direction: column-reverse; } /* Move sidebar to bottom */
      
      .sidebar {
        width: 100%; 
        height: calc(70px + var(--safe-bottom)); /* Dynamic height for iPhone Home Bar */
        flex-direction: row; 
        justify-content: space-evenly;
        padding: 10px 10px calc(10px + var(--safe-bottom)) 10px;
        border-right: none;
        border-top: 1px solid var(--glass-border);
        background: rgba(10, 10, 10, 0.85); /* Darker on mobile for contrast */
      }
      .nav-logo { display: none; }
      .nav-item { width: 48px; height: 48px; font-size: 1.4rem; }
      .nav-item .tooltip { display: none !important; } /* No tooltips on touch */
      .spacer { display: none; } 
    }

    /* ===== MAIN CONTENT ===== */
    .main-content { 
      flex: 1; 
      padding: 2.5rem; 
      padding-top: calc(2rem + var(--safe-top)); /* Status bar spacing */
      overflow-y: auto; 
      position: relative; 
      scroll-behavior: smooth;
    }

    /* Transitions */
    .view-section { display: none; animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .view-section.active { display: block; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

    /* HEADER */
    .view-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 2.5rem; flex-wrap: wrap; gap: 1rem;
    }
    .view-title h1 { 
      margin: 0; font-weight: 800; font-size: clamp(2rem, 5vw, 3.5rem); /* Liquid Font Size */
      letter-spacing: -1.5px;
      background: linear-gradient(180deg, #fff 0%, #cbd5e1 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .view-title span { color: var(--accent); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; display: block; margin-bottom: 5px; }

    .header-right { display: flex; align-items: center; gap: 1.5rem; }

    /* SEARCH BAR */
    .search-box {
      position: relative; display: flex; align-items: center;
      background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
      border-radius: var(--radius-pill); padding: 0.6rem 1.2rem;
      transition: all 0.3s ease;
    }
    .search-box input {
      background: transparent; border: none; color: white; outline: none;
      width: 180px; font-size: 1rem; margin-left: 0.75rem; font-weight: 500;
    }
    .search-box i { color: var(--accent); font-size: 1.2rem; }

    .clock-widget { text-align: right; }
    .clock-time { font-size: 1.8rem; font-weight: 200; line-height: 1; font-variant-numeric: tabular-nums; }
    .clock-date { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    /* ===== RESPONSIVE GRID ===== */
    .grid-dashboard { 
      display: grid; 
      /* Auto-fit columns: Sticks to 1 column on mobile, 2-3 on tablet/desktop */
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 1.5rem; 
    }
    
    /* GLASS CARD */
    .glass-card {
      position: relative;
      background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.01) 100%);
      border: 1px solid var(--glass-border);
      border-top: 1px solid var(--glass-highlight);
      border-radius: var(--radius-lg);
      padding: 2rem;
      backdrop-filter: blur(50px) saturate(180%);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      box-shadow: var(--glass-shadow);
      overflow: hidden;
    }

    /* HERO CARD SPECIFIC */
    .hero-card {
      grid-column: 1 / -1; min-height: 320px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 2rem 4rem;
      background: linear-gradient(120deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    }

    /* Dynamic Fonts inside cards */
    .metric-label { font-size: 0.85rem; font-weight: 700; letter-spacing: 1.5px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.5rem; }
    .metric-val { font-size: 3rem; font-weight: 700; letter-spacing: -1px; }
    
    /* Massive Hero Temp with Clamp */
    #val-temp {
      font-size: clamp(4rem, 10vw, 7rem); /* Scales smoothly from mobile to desktop */
      font-weight: 800; line-height:1; letter-spacing: -4px;
    }

    /* ===== WEATHER ICON ENGINE ===== */
    .weather-icon-stage { position: relative; width: 200px; height: 200px; transform: scale(1); }
    
    /* Cloud & Sun CSS Animations (Same as before but responsive scale) */
    .glass-cloud {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 140px; height: 70px;
      background: rgba(255, 255, 255, 0.45); border-radius: 60px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.8), 0 15px 30px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.6); z-index: 10;
      animation: float 6s ease-in-out infinite;
    }
    .glass-cloud::after {
      content: ''; position: absolute; width: 80px; height: 80px;
      top: -45px; left: 25px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit; border-top: 1px solid rgba(255,255,255,0.6);
    }
    .glass-cloud::before {
      content: ''; position: absolute; width: 60px; height: 60px;
      top: -25px; left: 70px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit;
    }
    @keyframes float { 0%, 100% { transform: translate(-50%, -50%); } 50% { transform: translate(-50%, -60%); } }

    .sun-glare {
      position: absolute; top: 10px; right: 20px; width: 90px; height: 90px;
      background: radial-gradient(circle, #fbbf24 0%, #f59e0b 40%, transparent 80%);
      border-radius: 50%; filter: blur(10px); opacity: 0; z-index: 5;
      animation: pulse-sun 4s ease-in-out infinite;
    }
    @keyframes pulse-sun { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

    .lightning-bolt {
      position: absolute; top: 60%; left: 50%; width: 0; height: 0;
      border-left: 10px solid transparent; border-right: 15px solid transparent; border-top: 40px solid #fef08a;
      transform: translateX(-50%) skew(-20deg); filter: drop-shadow(0 0 15px #facc15); opacity: 0; z-index: 8;
    }
    .bolt-anim { animation: flash 3s infinite; }
    @keyframes flash { 0%, 90%, 100% { opacity: 0; } 92% { opacity: 1; } 94% { opacity: 0; } 96% { opacity: 1; } }

    .rain-drop {
      position: absolute; background: #a5f3fc; width: 3px; height: 15px;
      border-radius: 2px; opacity: 0; top: 60%; animation: rain 1s linear infinite;
    }
    @keyframes rain { 0% { opacity: 0; transform: translateY(0); } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(60px); } }

    /* ===== MOBILE BREAKPOINTS ===== */
    @media (max-width: 768px) {
      /* Adjust Layout */
      .main-content { padding: 1.5rem; padding-bottom: 120px; } /* Extra bottom padding for nav */
      
      /* Stack Header items */
      .header-right { width: 100%; justify-content: space-between; margin-top: 1rem; }
      .search-box { flex: 1; margin-right: 1rem; }
      .search-box input { width: 100%; min-width: 50px; }
      
      /* Adjust Hero Card */
      .hero-card { 
        flex-direction: column; text-align: center; padding: 2rem; 
        gap: 1.5rem; align-items: center; 
      }
      .weather-icon-stage { transform: scale(0.9); } /* Shrink icon slightly */
      
      /* Adjust Metrics Grid */
      .grid-dashboard { gap: 1rem; }
      
      /* Fonts */
      .clock-time { font-size: 1.5rem; }
    }
  
    /* ===== CLOCK GLASS (SUN-THROUGH GLASS) ===== */
    .clock-glass{
      position: relative;
      padding: 0.9rem 1.1rem;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.20);
      border-top: 1px solid rgba(255,255,255,0.55);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
      backdrop-filter: blur(60px) saturate(220%);
      -webkit-backdrop-filter: blur(60px) saturate(220%);
      box-shadow:
        0 30px 80px rgba(0,0,0,0.55),
        inset 0 1px 0 rgba(255,255,255,0.40);
      overflow: hidden;
      min-width: 170px;
    }
    .clock-glass::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 20% 25%, rgba(255,255,255,0.50) 0%, rgba(255,255,255,0.10) 22%, transparent 55%),
        linear-gradient(115deg, transparent 0%, rgba(255,255,255,0.18) 32%, rgba(255,255,255,0.02) 55%, transparent 70%);
      transform: rotate(8deg);
      filter: blur(10px);
      opacity: 0.9;
      animation: sunSweep 6.5s ease-in-out infinite;
      pointer-events:none;
    }
    .clock-glass::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.20), transparent 35%),
        radial-gradient(circle at 80% 20%, rgba(34,211,238,0.15), transparent 55%);
      mix-blend-mode: screen;
      pointer-events:none;
    }
    @keyframes sunSweep{
      0%,100%{ transform: translateX(-6%) rotate(8deg); opacity:0.75; }
      50%{ transform: translateX(8%) rotate(8deg); opacity:1; }
    }

    /* ===== CLICKABLE METRIC CARDS ===== */
    .metric-card{ cursor: pointer; }
    .metric-card:focus{ outline: none; box-shadow: 0 0 0 2px rgba(165,243,252,0.35), var(--glass-shadow); }
    .tap-hint{
      margin-top: 1.25rem;
      font-size: 0.75rem;
      letter-spacing: 1.4px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
    }
    .metric-card:hover .tap-hint{ border-color: rgba(255,255,255,0.25); }

    /* ===== DETAIL MODAL ===== */
    .detail-overlay{
      position: fixed; inset:0;
      display:none;
      align-items: center; justify-content: center;
      padding: 1.25rem;
      padding-bottom: calc(1.25rem + var(--safe-bottom));
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      z-index: 999;
    }
    .detail-overlay.active{ display:flex; animation: fadeUp 0.35s ease forwards; }
    .detail-modal{
      width: min(720px, 100%);
      padding: 1.6rem;
      border-radius: 34px;
      background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
    }
    .detail-close{
      position:absolute;
      top: 14px; right: 14px;
      width: 44px; height: 44px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: white;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
    }
    .detail-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap: 1rem; flex-wrap: wrap;
      padding-right: 54px;
    }
    .detail-title{
      font-size: clamp(1.4rem, 4.5vw, 2.2rem);
      font-weight: 800;
      letter-spacing: -1px;
      margin-top: 0.25rem;
    }
    .detail-readout{ text-align:right; min-width: 160px; }
    .detail-value{
      font-variant-numeric: tabular-nums;
      font-size: clamp(2rem, 7vw, 3rem);
      font-weight: 800;
      letter-spacing: -1px;
      color: rgba(255,255,255,0.98);
      text-shadow: 0 0 20px rgba(255,255,255,0.12);
    }
    .detail-sub{
      color: rgba(255,255,255,0.65);
      font-weight: 650;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 0.78rem;
    }
    .detail-scene{
      position: relative;
      margin-top: 1.2rem;
      height: 260px;
      border-radius: 26px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(50px) saturate(200%);
      -webkit-backdrop-filter: blur(50px) saturate(200%);
    }
    .detail-notes{
      margin-top: 1rem;
      color: rgba(255,255,255,0.60);
      font-size: 0.95rem;
      line-height: 1.35;
    }

    /* ===== SCENES ===== */
    .scene-layer{ position:absolute; inset:0; }
    /* Humidity: water + mist */
    .scene-humidity .water{
      position:absolute; left:-20%; right:-20%; bottom:-35%;
      height: 70%;
      background:
        radial-gradient(circle at 20% 30%, rgba(165,243,252,0.35), transparent 55%),
        radial-gradient(circle at 70% 40%, rgba(56,189,248,0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(56,189,248,0.10));
      filter: blur(0px);
      border-top: 1px solid rgba(255,255,255,0.22);
      transform: rotate(-2deg);
      animation: waterSway 6s ease-in-out infinite;
    }
    .scene-humidity .water::before{
      content:"";
      position:absolute; inset:-20% -10%;
      background:
        radial-gradient(circle at 10% 50%, rgba(255,255,255,0.10), transparent 55%),
        radial-gradient(circle at 60% 60%, rgba(255,255,255,0.08), transparent 55%);
      filter: blur(18px);
      opacity: 0.9;
      animation: mistDrift 7.5s ease-in-out infinite;
    }
    .scene-humidity .droplets{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 30%, rgba(255,255,255,0.25) 0 2px, transparent 3px),
        radial-gradient(circle at 35% 45%, rgba(255,255,255,0.20) 0 2px, transparent 3px),
        radial-gradient(circle at 55% 28%, rgba(255,255,255,0.22) 0 2px, transparent 3px),
        radial-gradient(circle at 70% 50%, rgba(255,255,255,0.18) 0 2px, transparent 3px),
        radial-gradient(circle at 82% 35%, rgba(255,255,255,0.22) 0 2px, transparent 3px);
      opacity: 0.55;
      animation: dropletPulse 2.8s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes waterSway{ 0%,100%{ transform: translateX(0) rotate(-2deg); } 50%{ transform: translateX(6%) rotate(-2deg); } }
    @keyframes mistDrift{ 0%,100%{ transform: translateX(-3%); opacity:0.7; } 50%{ transform: translateX(4%); opacity:1; } }
    @keyframes dropletPulse{ 0%,100%{ opacity:0.35; } 50%{ opacity:0.65; } }

    /* Pressure: gauge + silhouettes */
    .scene-pressure .sky{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,0.18), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(165,243,252,0.12), transparent 60%),
        linear-gradient(180deg, rgba(30,27,75,0.55), rgba(0,0,0,0.25));
    }
    .scene-pressure .horizon{
      position:absolute; left:-10%; right:-10%; bottom:-15%;
      height: 55%;
      background:
        linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.55)),
        radial-gradient(circle at 40% 60%, rgba(255,255,255,0.06), transparent 55%);
      filter: blur(0px);
      transform: translateX(0);
      animation: horizonPan 8s ease-in-out infinite;
    }
    .scene-pressure .silhouettes{
      position:absolute; left:0; right:0; bottom:22px; height: 90px;
      opacity: 0.55;
      background:
        linear-gradient(to top, rgba(0,0,0,0.55), transparent 70%),
        radial-gradient(circle at 12% 80%, rgba(0,0,0,0.7) 0 22px, transparent 23px),
        radial-gradient(circle at 18% 75%, rgba(0,0,0,0.7) 0 18px, transparent 19px),
        radial-gradient(circle at 25% 78%, rgba(0,0,0,0.7) 0 26px, transparent 27px),
        radial-gradient(circle at 65% 82%, rgba(0,0,0,0.7) 0 14px, transparent 15px),
        radial-gradient(circle at 72% 80%, rgba(0,0,0,0.7) 0 18px, transparent 19px);
      filter: blur(1px);
      animation: silhouettesDrift 6.2s ease-in-out infinite;
    }
    .scene-pressure .gauge{
      position:absolute; top:18px; right:18px;
      width: 150px; height: 150px; border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.22);
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0.04) 55%, rgba(255,255,255,0.02));
      backdrop-filter: blur(35px);
      -webkit-backdrop-filter: blur(35px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.35), 0 20px 50px rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .scene-pressure .needle{
      position:absolute; left:50%; top:50%;
      width: 2px; height: 58px;
      background: rgba(165,243,252,0.9);
      transform-origin: bottom;
      transform: translate(-50%,-100%) rotate(-25deg);
      filter: drop-shadow(0 0 12px rgba(165,243,252,0.65));
      animation: needleSwing 4.8s ease-in-out infinite;
    }
    .scene-pressure .gauge::after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 50%;
      border: 1px dashed rgba(255,255,255,0.18);
      opacity: 0.75;
    }
    @keyframes needleSwing{ 0%,100%{ transform: translate(-50%,-100%) rotate(-22deg);} 50%{ transform: translate(-50%,-100%) rotate(22deg);} }
    @keyframes silhouettesDrift{ 0%,100%{ transform: translateX(-2%);} 50%{ transform: translateX(3%);} }
    @keyframes horizonPan{ 0%,100%{ transform: translateX(-1%);} 50%{ transform: translateX(2%);} }

    /* Visibility: fog density + headlight beams */
    .scene-visibility .fog{
      position:absolute; inset:-10%;
      background:
        radial-gradient(circle at 25% 40%, rgba(255,255,255,0.14), transparent 55%),
        radial-gradient(circle at 65% 45%, rgba(255,255,255,0.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.18));
      filter: blur(12px);
      opacity: 0.9;
      animation: fogBreath 5.6s ease-in-out infinite;
    }
    .scene-visibility .road{
      position:absolute; left:0; right:0; bottom:0; height: 45%;
      background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.65));
    }
    .scene-visibility .car{
      position:absolute; left: 18px; bottom: 28px;
      width: 84px; height: 32px; border-radius: 14px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      animation: carCreep 6.8s ease-in-out infinite;
    }
    .scene-visibility .beam{
      position:absolute; left: 70px; bottom: 40px;
      width: 240px; height: 120px;
      background: conic-gradient(from 220deg at 0% 80%, rgba(255,255,255,0.26), rgba(255,255,255,0.02), transparent 55%);
      filter: blur(8px);
      opacity: 0.7;
      transform: skewX(-10deg);
      animation: beamFlicker 2.6s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes fogBreath{ 0%,100%{ opacity:0.95; transform: translateX(-1%);} 50%{ opacity:0.75; transform: translateX(2%);} }
    @keyframes beamFlicker{ 0%,100%{ opacity:0.65;} 50%{ opacity:0.85;} }
    @keyframes carCreep{ 0%,100%{ transform: translateX(0);} 50%{ transform: translateX(18px);} }
    
    /* ===== SETTINGS TOGGLES ===== */
    .settings-group {
      background: rgba(255,255,255,0.05);
      border-radius: 20px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--glass-border);
    }
    .setting-row {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 1rem;
    }
    .setting-row:last-child { margin-bottom: 0; }
    .setting-label { font-size: 1rem; font-weight: 500; }

    /* Switch Toggle */
    .switch {
      position: relative; display: inline-block; width: 50px; height: 28px;
    }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute; cursor: pointer; inset: 0;
      background-color: rgba(255,255,255,0.2);
      border-radius: 34px; transition: .4s;
    }
    .slider:before {
      position: absolute; content: ""; height: 20px; width: 20px;
      left: 4px; bottom: 4px; background-color: white;
      border-radius: 50%; transition: .4s;
    }
    input:checked + .slider { background-color: var(--accent); }
    input:checked + .slider:before { transform: translateX(22px); }

    /* ===== WAVE ANIMATION (For Wind Tab) ===== */
    .wave {
      position: absolute; bottom: 0; left: 0; width: 200%; height: 100px;
      background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg"><path fill="rgba(165, 243, 252, 0.2)" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
      background-size: 50% 100%;
      animation: waveMove 10s linear infinite;
      transform: translate3d(0, 0, 0);
    }
    .wave:nth-child(2) {
      bottom: 10px; opacity: 0.5;
      animation: waveMove 7s linear infinite reverse;
    }
    @keyframes waveMove { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    @media (max-width: 768px){
      .clock-glass{ min-width: 150px; padding: 0.75rem 0.9rem; }
      .detail-scene{ height: 240px; }
    }

  </style>
</head>
<body>

  <div class="app-bg" id="app-bg"></div>
  <div class="app-noise"></div>

  <div class="app-container">
    <nav class="sidebar">
      <div class="nav-logo"><i class="ph-fill ph-planet"></i></div>
      <button class="nav-item active" onclick="switchTab('dashboard', this)">
        <i class="ph-bold ph-squares-four"></i>
      </button>
      <button class="nav-item" onclick="switchTab('wind', this)">
        <i class="ph-bold ph-wind"></i>
      </button>
      <button class="nav-item" onclick="switchTab('radar', this)">
        <i class="ph-bold ph-radar"></i>
      </button>
      <button class="nav-item" onclick="switchTab('astro', this)">
        <i class="ph-bold ph-sun-horizon"></i>
      </button>
      <div class="spacer" style="flex:1"></div>
      <button class="nav-item" onclick="switchTab('settings', this)">
        <i class="ph-bold ph-gear"></i>
      </button>
    </nav>

    <main class="main-content">
      
      <section id="view-dashboard" class="view-section active">
        <header class="view-header">
          <div class="view-title">
            <span>NetWatch Broadcast System</span>
            <h1>System Overview</h1>
          </div>
          <div class="header-right">
             <div class="search-box">
                <i class="ph-bold ph-magnifying-glass"></i>
                <input type="text" id="loc-search" placeholder="City or Zip..." onkeydown="handleSearch(event)">
             </div>
             <div class="clock-glass" role="group" aria-label="System clock">
               <div class="clock-widget">
                  <div class="clock-time" id="clock-time">--:--:--</div>
                  <div class="clock-date" id="clock-date">--</div>
               </div>
             </div>
          </div>
        </header>

        <div class="grid-dashboard">
          <div class="glass-card hero-card">
            <div>
              <div style="font-size:1.1rem; opacity:0.8; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                <i class="ph-fill ph-map-pin"></i> <span id="loc-name">Locating...</span>
              </div>
              <div id="val-temp">--°</div>
              <div style="color:var(--accent); margin-top:0.5rem; font-size:1.4rem; font-weight:600;" id="val-cond">--</div>
            </div>
            
            <div class="weather-icon-stage" id="icon-stage">
               <div class="glass-cloud"></div>
            </div>
          </div>

          <div class="glass-card metric-card" data-metric="humidity" tabindex="0" role="button" aria-label="Humidity details">
            <div class="metric-label">Humidity</div>
            <div class="metric-val" id="val-humid">--%</div>
            <div class="metric-sub">Dew Point: <span id="val-dew">--</span>°</div>
            <div class="tap-hint">Tap for details</div>
          </div>
          <div class="glass-card metric-card" data-metric="pressure" tabindex="0" role="button" aria-label="Pressure details">
            <div class="metric-label">Pressure</div>
            <div class="metric-val" id="val-press">--</div>
            <div class="metric-sub" style="font-size:1rem">hPa</div>
            <div class="tap-hint">Tap for details</div>
          </div>
          <div class="glass-card metric-card" data-metric="visibility" tabindex="0" role="button" aria-label="Visibility details">
            <div class="metric-label">Visibility</div>
            <div class="metric-val" id="val-vis">--</div>
            <div class="metric-sub" style="font-size:1rem">Miles</div>
            <div class="tap-hint">Tap for details</div>
          </div>
        </div>
      </section>

      <section id="view-wind" class="view-section">
        <header class="view-header"><div class="view-title"><span>Simulation</span><h1>Live Ocean</h1></div></header>
        <div class="glass-card" style="padding:0; height:400px; position:relative; overflow:hidden;">
           <div class="ocean-scene" id="ocean-scene" style="height:100%; width:100%; border:none;">
              <div class="wave"></div>
              <div class="wave"></div>
              
              <div style="position:absolute; bottom:-20px; right:20px; width:200px; animation: sway 3s ease-in-out infinite alternate;">
                 <svg viewBox="0 0 200 300" fill="none"><path d="M98 300C86 248 84 205 88 160C92 110 110 60 120 0" stroke="rgba(0,0,0,0.4)" stroke-width="10" stroke-linecap="round"/><path d="M118 22C150 30 180 52 196 78" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 35C145 55 165 78 178 105" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/><path d="M118 22C85 35 55 58 25 86" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 40C90 60 70 85 52 112" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/></svg>
              </div>
              <div style="position:absolute; bottom:20px; left:20px; z-index:10;">
                 <div style="font-size:4rem; font-weight:800; line-height:1" id="wind-big">--</div>
                 <div style="font-weight:700; opacity:0.8; letter-spacing:2px">MPH WIND</div>
              </div>
           </div>
        </div>
      </section>

      <section id="view-radar" class="view-section">
        <header class="view-header"><div class="view-title"><span>Map</span><h1>Live Radar</h1></div></header>
        <div style="width:100%; height:60vh; border-radius:32px; overflow:hidden; border:1px solid var(--glass-border);" id="radar-container">
           <div style="height:100%; display:flex; align-items:center; justify-content:center;">Loading Radar...</div>
        </div>
      </section>

      <section id="view-astro" class="view-section">
         <header class="view-header"><div class="view-title"><span>Celestial</span><h1>Sun & Moon</h1></div></header>
         <div class="grid-dashboard">
            <div class="glass-card">
               <div class="metric-label">Sunrise</div>
               <div class="metric-val" id="val-rise">--</div>
            </div>
            <div class="glass-card">
               <div class="metric-label">Sunset</div>
               <div class="metric-val" id="val-set">--</div>
            </div>
         </div>
      </section>
      
      <section id="view-settings" class="view-section">
        <header class="view-header">
          <div class="view-title"><span>System</span><h1>Preferences</h1></div>
        </header>
        
        <div class="grid-dashboard" style="display: block; max-width: 600px;">
          <div class="settings-group">
            <div class="setting-row">
              <span class="setting-label">Temperature Unit (°F / °C)</span>
              <label class="switch">
                <input type="checkbox" id="toggle-unit" onchange="state.unit = this.checked ? 'celsius' : 'fahrenheit'; localStorage.setItem('nw_unit', state.unit); fetchWeather();">
                <span class="slider"></span>
              </label>
            </div>
            <div class="setting-row">
              <span class="setting-label">24-Hour Time</span>
              <label class="switch">
                <input type="checkbox" id="toggle-time" onchange="state.use24h = this.checked; localStorage.setItem('nw_24h', state.use24h); updateClock(); fetchWeather();">
                <span class="slider"></span>
              </label>
            </div>
          </div>
          
          <div class="glass-card" style="padding:1.5rem; text-align:center; opacity:0.7;">
            <p style="margin:0; font-size:0.9rem;">NetWatch Pro v2.1<br>Ready for deployment</p>
          </div>
        </div>
      </section>

    
      <div class="detail-overlay" id="detail-overlay" aria-hidden="true">
        <div class="detail-modal glass-card" role="dialog" aria-modal="true" aria-labelledby="detail-title">
          <button class="detail-close" id="detail-close" aria-label="Close details">
            <i class="ph-bold ph-x"></i>
          </button>

          <div class="detail-head">
            <div>
              <div class="metric-label" id="detail-kicker">Metric</div>
              <div class="detail-title" id="detail-title">Details</div>
            </div>
            <div class="detail-readout">
              <div class="detail-value" id="detail-value">--</div>
              <div class="detail-sub" id="detail-sub">--</div>
            </div>
          </div>

          <div class="detail-scene" id="detail-scene">
            </div>

          <div class="detail-notes" id="detail-notes">
            Tap different cards for different “forecast feel” visuals.
          </div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // ===== STATE & CONFIG =====
    let state = {
      lat: null,
      lon: null,
      city: "Locating...",
      region: "",
      unit: localStorage.getItem('nw_unit') || 'fahrenheit', // 'fahrenheit' or 'celsius'
      use24h: localStorage.getItem('nw_24h') === 'true',
      windSpeed: 0, // stored for simulation
      timezone: Intl.DateTimeFormat().resolvedOptions().timeZone // Defaults to user local time
    };

    const ui = {
      loc: document.getElementById('loc-name'),
      temp: document.getElementById('val-temp'),
      cond: document.getElementById('val-cond'),
      humid: document.getElementById('val-humid'),
      dew: document.getElementById('val-dew'),
      press: document.getElementById('val-press'),
      vis: document.getElementById('val-vis'),
      windBig: document.getElementById('wind-big'),
      radar: document.getElementById('radar-container'),
      iconStage: document.getElementById('icon-stage'),
      rise: document.getElementById('val-rise'),
      set: document.getElementById('val-set'),
      waves: document.querySelectorAll('.wave'),
      toggleUnit: document.getElementById('toggle-unit'),
      toggleTime: document.getElementById('toggle-time')
    };

    // ===== INIT =====
    function initApp() {
      // Load Settings
      ui.toggleUnit.checked = (state.unit === 'celsius');
      ui.toggleTime.checked = state.use24h;

      // Start Clock
      setInterval(updateClock, 1000); updateClock();

      // Get Location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => { 
            state.lat = pos.coords.latitude; 
            state.lon = pos.coords.longitude; 
            fetchLocationName(state.lat, state.lon); 
          },
          () => { console.warn("GPS Denied. IP Fallback."); getLocationByIP(); }
        );
      } else { getLocationByIP(); }
    }

    // ===== CLOCK (UPDATED FOR TIMEZONE SUPPORT) =====
    function updateClock() {
        const now = new Date();
        
        // Define options for time formatting using the fetched Timezone
        const timeOpts = { 
          timeZone: state.timezone, 
          hour: 'numeric', 
          minute: '2-digit', 
          hour12: !state.use24h 
        };
        if(state.use24h) { timeOpts.second = '2-digit'; }

        // Define options for date formatting using the fetched Timezone
        const dateOpts = {
          timeZone: state.timezone,
          weekday: 'short', 
          month: 'short', 
          day: 'numeric'
        };
        
        document.getElementById('clock-time').textContent = now.toLocaleTimeString('en-US', timeOpts);
        document.getElementById('clock-date').textContent = now.toLocaleDateString('en-US', dateOpts);
    }

    // ===== GEOCODING & SEARCH =====
    async function getLocationByIP() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        state.lat = data.latitude; state.lon = data.longitude;
        ui.loc.textContent = `${data.city}, ${data.region_code}`;
        fetchWeather();
      } catch (e) { ui.loc.textContent = "Location Unknown"; }
    }

    async function fetchLocationName(lat, lon) {
        try {
            const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
            const data = await res.json();
            ui.loc.textContent = `${data.city}, ${data.principalSubdivisionCode}`;
            fetchWeather();
        } catch(e) { ui.loc.textContent = "Current Location"; fetchWeather(); }
    }

    async function handleSearch(e) {
        if(e.key === 'Enter') {
            const query = document.getElementById('loc-search').value;
            if(!query) return;
            
            ui.loc.textContent = "Searching...";
            // Use Open-Meteo Geocoding API
            try {
              const res = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${query}&count=1&language=en&format=json`);
              const data = await res.json();
              
              if(data.results && data.results.length > 0) {
                const result = data.results[0];
                state.lat = result.latitude;
                state.lon = result.longitude;
                ui.loc.textContent = `${result.name}, ${result.admin1 || result.country_code}`;
                fetchWeather();
                document.getElementById('loc-search').value = ""; // clear input
                document.getElementById('loc-search').blur();
              } else {
                alert("Location not found. Try a major city name.");
                ui.loc.textContent = "Unknown";
              }
            } catch(err) {
              console.error(err);
              ui.loc.textContent = "Error";
            }
        }
    }

    // ===== WEATHER ENGINE =====
    async function fetchWeather() {
      if (!state.lat || !state.lon) return;
      
      const unitParam = state.unit === 'fahrenheit' ? 'fahrenheit' : 'celsius';
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${state.lat}&longitude=${state.lon}&current_weather=true&hourly=relativehumidity_2m,visibility,pressure_msl,dewpoint_2m&daily=sunrise,sunset&windspeed_unit=mph&temperature_unit=${unitParam}&timezone=auto`;
      
      try {
        const res = await fetch(url);
        const data = await res.json();
        const curr = data.current_weather;
        
        // --- KEY CHANGE: UPDATE TIMEZONE ---
        state.timezone = data.timezone; // Gets "America/Chicago", "Asia/Tokyo", etc.
        updateClock(); // Force immediate clock update to new zone
        // -----------------------------------

        // Main Cards
        ui.temp.textContent = Math.round(curr.temperature) + "°";
        ui.cond.textContent = getWeatherDesc(curr.weathercode);
        
        // Wind Physics
        state.windSpeed = curr.windspeed;
        ui.windBig.textContent = Math.round(state.windSpeed);
        updateOceanPhysics(state.windSpeed);

        // Metrics
        ui.humid.textContent = data.hourly.relativehumidity_2m[0] + "%";
        ui.dew.textContent = Math.round(data.hourly.dewpoint_2m[0]);
        ui.press.textContent = Math.round(data.hourly.pressure_msl[0]);
        
        // Convert visibility meters to Miles or KM based on unit preference roughly
        let vis = data.hourly.visibility[0];
        let visText = (vis / 1609).toFixed(1); // Default miles
        if(state.unit === 'celsius') visText = (vis / 1000).toFixed(1); // KM for Metric users
        ui.vis.textContent = visText;
        document.querySelector('[data-metric="visibility"] .metric-sub').innerText = state.unit === 'celsius' ? 'KM' : 'Miles';

        // Astro
        ui.rise.textContent = formatAstroTime(data.daily.sunrise[0]);
        ui.set.textContent = formatAstroTime(data.daily.sunset[0]);

        renderIcon(curr.weathercode, curr.is_day);
        
        // Load Radar (Windy API)
        ui.radar.innerHTML = `<iframe src="https://embed.windy.com/embed2.html?lat=${state.lat}&lon=${state.lon}&detailLat=${state.lat}&detailLon=${state.lon}&width=650&height=450&zoom=10&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1" width="100%" height="100%" frameborder="0"></iframe>`;

      } catch(e) { console.error(e); }
    }

    // ===== HELPERS & PHYSICS =====
    
    function formatAstroTime(isoString) {
      if(!isoString) return "--";
      // We parse the date, but print it using the Location's timezone
      const date = new Date(isoString);
      return date.toLocaleTimeString([], {
        timeZone: state.timezone,
        hour: 'numeric', 
        minute: '2-digit', 
        hour12: !state.use24h
      });
    }

    function updateOceanPhysics(speed) {
      // Adjust animation speed based on wind (Inverse: Higher speed = Lower duration)
      // Base duration 10s. If wind is 20mph, duration = 5s.
      let duration = 10;
      if(speed > 0) duration = 200 / (speed + 10); // Simple physics formula
      if(duration < 2) duration = 2; // Cap max speed
      
      ui.waves.forEach(wave => {
        wave.style.animationDuration = `${duration}s`;
      });
    }

    function toggleUnit() {
      state.unit = ui.toggleUnit.checked ? 'celsius' : 'fahrenheit';
      localStorage.setItem('nw_unit', state.unit);
      fetchWeather(); // Refetch to get new numbers
    }

    function toggleTimeFmt() {
      state.use24h = ui.toggleTime.checked;
      localStorage.setItem('nw_24h', state.use24h);
      updateClock();
      fetchWeather(); // Update Sunrise/set format
    }

    function renderIcon(code, isDay) {
        const stage = ui.iconStage;
        let html = `<div class="glass-cloud"></div>`;
        if (code < 3) html += `<div class="sun-glare" style="opacity:${isDay?0.8:0.3}; background:${isDay?'radial-gradient(circle, #fbbf24 0%, transparent 70%)':'radial-gradient(circle, #f8fafc 0%, transparent 70%)'}"></div>`;
        if (code > 50) { for(let i=0; i<5; i++) html += `<div class="rain-drop" style="left:${20 + i*15}px; animation-delay:${i*0.2}s"></div>`; }
        if (code >= 95) html += `<div class="lightning-bolt bolt-anim"></div>`;
        stage.innerHTML = html;
    }

    function getWeatherDesc(code) {
      if(code === 0) return "Clear Sky";
      if(code < 4) return "Partly Cloudy";
      if(code < 50) return "Foggy";
      if(code < 80) return "Rain";
      return "Thunderstorm";
    }

    function switchTab(id, btn) {
      document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
      document.getElementById('view-'+id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
      btn.classList.add('active');
    }
    
    // Modal Logic
    const overlay = document.getElementById('detail-overlay');
    const closeBtn = document.getElementById('detail-close');
    const scene = document.getElementById('detail-scene');
    const titleEl = document.getElementById('detail-title');
    const kickerEl = document.getElementById('detail-kicker');
    const valEl = document.getElementById('detail-value');
    const subEl = document.getElementById('detail-sub');
    const notesEl = document.getElementById('detail-notes');

    function openDetail(metric){
      const map = {
        humidity: { kicker: "Humidity", title: "Moisture & Dew", value: () => ui.humid.textContent, sub: () => `Dew Point: ${ui.dew.textContent}°`, notes: "High humidity can mean fog, haze, or a sticky feel." },
        pressure: { kicker: "Pressure", title: "Atmospheric Load", value: () => ui.press.textContent + " hPa", sub: () => "Barometer", notes: "Pressure trends influence storms, wind, and stability." },
        visibility: { kicker: "Visibility", title: "Fog & Distance", value: () => ui.vis.textContent + (state.unit === 'celsius' ? ' km' : ' mi'), sub: () => "Clear Line of Sight", notes: "Lower visibility comes with fog or heavy precipitation." }
      };
      const cfg = map[metric];
      if(!cfg) return;
      kickerEl.textContent = cfg.kicker; titleEl.textContent = cfg.title; valEl.textContent = cfg.value(); subEl.textContent = cfg.sub(); notesEl.textContent = cfg.notes;
      
      scene.className = "detail-scene"; scene.innerHTML = "";
      if(metric === "humidity") { scene.classList.add("scene-humidity"); scene.innerHTML = `<div class="scene-layer droplets"></div><div class="scene-layer water"></div>`; }
      if(metric === "pressure") { scene.classList.add("scene-pressure"); scene.innerHTML = `<div class="scene-layer sky"></div><div class="scene-layer horizon"></div><div class="scene-layer silhouettes"></div><div class="gauge"><div class="needle"></div></div>`; }
      if(metric === "visibility") { scene.classList.add("scene-visibility"); scene.innerHTML = `<div class="scene-layer fog"></div><div class="scene-layer road"></div><div class="car"></div><div class="beam"></div>`; }
      overlay.classList.add('active'); overlay.setAttribute('aria-hidden', 'false'); document.body.style.overflow = 'hidden';
    }

    function closeDetail(){ overlay.classList.remove('active'); overlay.setAttribute('aria-hidden', 'true'); scene.innerHTML = ""; document.body.style.overflow = ''; }

    document.querySelectorAll('.metric-card').forEach(card => {
       card.addEventListener('click', () => openDetail(card.getAttribute('data-metric')));
    });
    overlay.addEventListener('click', (e) => { if(e.target === overlay) closeDetail(); });
    closeBtn.addEventListener('click', closeDetail);

    // Boot
    initApp();
  </script>
</body>
</html>
