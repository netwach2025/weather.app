<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NetWatch Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    /* =========================================
       NETWATCH PRO: RESPONSIVE ENGINE
       ========================================= */
    :root {
      --bg-deep: #000000;
      --accent: #a5f3fc;
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.6);

      --glass-surface: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.18);
      --glass-highlight: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);

      --radius-lg: 32px;
      --radius-pill: 999px;
      --sidebar-width: 88px;

      /* Safe Area Variables for iPhone Notch/Home Bar */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; width: 100vw; height: 100vh;
      background: #000;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }

    /* ===== BACKGROUND ===== */
    .app-bg {
      position: fixed; inset: 0; z-index: -2;
      background: radial-gradient(circle at 50% 0%, #1e1b4b, #0f172a, #000);
      transition: background 2s ease;
    }
    .app-noise {
      position: fixed; inset: 0; z-index: -1; opacity: 0.07; pointer-events: none;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJuIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC44IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI24pIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=');
    }

    .app-container { display: flex; height: 100vh; width: 100vw; }

    /* ===== RESPONSIVE SIDEBAR / BOTTOM NAV ===== */
    .sidebar {
      width: var(--sidebar-width); height: 100%;
      background: rgba(10, 10, 10, 0.4);
      backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
      border-right: 1px solid var(--glass-border);
      display: flex; flex-direction: column; align-items: center;
      padding: 2.5rem 0; gap: 1.5rem; z-index: 100;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-logo { font-size: 2rem; color: var(--accent); margin-bottom: 2rem; filter: drop-shadow(0 0 15px rgba(34,211,238,0.6)); }

    .nav-item {
      position: relative; width: 56px; height: 56px;
      border-radius: 20px; display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); font-size: 1.6rem; cursor: pointer;
      border: none; background: transparent; transition: all 0.2s;
    }
    .nav-item:hover, .nav-item.active {
      color: #fff; background: rgba(255,255,255,0.1);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }
    .nav-item.active i { color: var(--accent); }

    /* Mobile-Only Nav Adjustments */
    @media (max-width: 768px) {
      .app-container { flex-direction: column-reverse; } /* Move sidebar to bottom */

      .sidebar {
        width: 100%; 
        height: calc(70px + var(--safe-bottom)); /* Dynamic height for iPhone Home Bar */
        flex-direction: row; 
        justify-content: space-evenly;
        padding: 10px 10px calc(10px + var(--safe-bottom)) 10px;
        border-right: none;
        border-top: 1px solid var(--glass-border);
        background: rgba(10, 10, 10, 0.85); /* Darker on mobile for contrast */
      }
      .nav-logo { display: none; }
      .nav-item { width: 48px; height: 48px; font-size: 1.4rem; }
      .nav-item .tooltip { display: none !important; } /* No tooltips on touch */

      /* Hide settings on mobile to save space if needed, or keep it */
      .spacer { display: none; } 
    }

    /* ===== MAIN CONTENT ===== */
    .main-content { 
      flex: 1; 
      padding: 2.5rem; 
      padding-top: calc(2rem + var(--safe-top)); /* Status bar spacing */
      overflow-y: auto; 
      position: relative; 
      scroll-behavior: smooth;
    }

    /* Transitions */
    .view-section { display: none; animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .view-section.active { display: block; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

    /* HEADER */
    .view-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 2.5rem; flex-wrap: wrap; gap: 1rem;
    }
    .view-title h1 { 
      margin: 0; font-weight: 800; font-size: clamp(2rem, 5vw, 3.5rem); /* Liquid Font Size */
      letter-spacing: -1.5px;
      background: linear-gradient(180deg, #fff 0%, #cbd5e1 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .view-title span { color: var(--accent); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; display: block; margin-bottom: 5px; }

    .header-right { display: flex; align-items: center; gap: 1.5rem; }

    /* SEARCH BAR */
    .search-box {
      position: relative; display: flex; align-items: center;
      background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
      border-radius: var(--radius-pill); padding: 0.6rem 1.2rem;
      transition: all 0.3s ease;
    }
    .search-box input {
      background: transparent; border: none; color: white; outline: none;
      width: 140px; font-size: 1rem; margin-left: 0.75rem; font-weight: 500;
    }
    .search-box i { color: var(--accent); font-size: 1.2rem; }

    .clock-widget { text-align: right; }
    .clock-time { font-size: 1.8rem; font-weight: 200; line-height: 1; font-variant-numeric: tabular-nums; }
    .clock-date { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    /* ===== RESPONSIVE GRID ===== */
    .grid-dashboard { 
      display: grid; 
      /* Auto-fit columns: Sticks to 1 column on mobile, 2-3 on tablet/desktop */
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 1.5rem; 
    }

    /* GLASS CARD */
    .glass-card {
      position: relative;
      background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.01) 100%);
      border: 1px solid var(--glass-border);
      border-top: 1px solid var(--glass-highlight);
      border-radius: var(--radius-lg);
      padding: 2rem;
      backdrop-filter: blur(50px) saturate(180%);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      box-shadow: var(--glass-shadow);
      overflow: hidden;
    }

    /* HERO CARD SPECIFIC */
    .hero-card {
      grid-column: 1 / -1; min-height: 320px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 2rem 4rem;
      background: linear-gradient(120deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    }

    /* Dynamic Fonts inside cards */
    .metric-label { font-size: 0.85rem; font-weight: 700; letter-spacing: 1.5px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.5rem; }
    .metric-val { font-size: 3rem; font-weight: 700; letter-spacing: -1px; }

    /* Massive Hero Temp with Clamp */
    #val-temp {
      font-size: clamp(4rem, 10vw, 7rem); /* Scales smoothly from mobile to desktop */
      font-weight: 800; line-height:1; letter-spacing: -4px;
    }

    /* ===== WEATHER ICON ENGINE ===== */
    .weather-icon-stage { position: relative; width: 200px; height: 200px; transform: scale(1); }

    /* Cloud & Sun CSS Animations (Same as before but responsive scale) */
    .glass-cloud {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 140px; height: 70px;
      background: rgba(255, 255, 255, 0.45); border-radius: 60px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.8), 0 15px 30px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.6); z-index: 10;
      animation: float 6s ease-in-out infinite;
    }
    .glass-cloud::after {
      content: ''; position: absolute; width: 80px; height: 80px;
      top: -45px; left: 25px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit; border-top: 1px solid rgba(255,255,255,0.6);
    }
    .glass-cloud::before {
      content: ''; position: absolute; width: 60px; height: 60px;
      top: -25px; left: 70px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit;
    }
    @keyframes float { 0%, 100% { transform: translate(-50%, -50%); } 50% { transform: translate(-50%, -60%); } }

    .sun-glare {
      position: absolute; top: 10px; right: 20px; width: 90px; height: 90px;
      background: radial-gradient(circle, #fbbf24 0%, #f59e0b 40%, transparent 80%);
      border-radius: 50%; filter: blur(10px); opacity: 0; z-index: 5;
      animation: pulse-sun 4s ease-in-out infinite;
    }
    @keyframes pulse-sun { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

    .lightning-bolt {
      position: absolute; top: 60%; left: 50%; width: 0; height: 0;
      border-left: 10px solid transparent; border-right: 15px solid transparent; border-top: 40px solid #fef08a;
      transform: translateX(-50%) skew(-20deg); filter: drop-shadow(0 0 15px #facc15); opacity: 0; z-index: 8;
    }
    .bolt-anim { animation: flash 3s infinite; }
    @keyframes flash { 0%, 90%, 100% { opacity: 0; } 92% { opacity: 1; } 94% { opacity: 0; } 96% { opacity: 1; } }

    .rain-drop {
      position: absolute; background: #a5f3fc; width: 3px; height: 15px;
      border-radius: 2px; opacity: 0; top: 60%; animation: rain 1s linear infinite;
    }
    @keyframes rain { 0% { opacity: 0; transform: translateY(0); } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(60px); } }

    /* ===== MOBILE BREAKPOINTS ===== */
    @media (max-width: 768px) {
      /* Adjust Layout */
      .main-content { padding: 1.5rem; padding-bottom: 120px; } /* Extra bottom padding for nav */

      /* Stack Header items */
      .header-right { width: 100%; justify-content: space-between; margin-top: 1rem; }
      .search-box { flex: 1; margin-right: 1rem; }
      .search-box input { width: 100%; min-width: 50px; }

      /* Adjust Hero Card */
      .hero-card { 
        flex-direction: column; text-align: center; padding: 2rem; 
        gap: 1.5rem; align-items: center; 
      }
      .weather-icon-stage { transform: scale(0.9); } /* Shrink icon slightly */

      /* Adjust Metrics Grid */
      .grid-dashboard { gap: 1rem; }

      /* Fonts */
      .clock-time { font-size: 1.5rem; }
    }

    /* ===== CLOCK GLASS (SUN-THROUGH GLASS) ===== */
    .clock-glass{
      position: relative;
      padding: 0.9rem 1.1rem;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,0.20);
      border-top: 1px solid rgba(255,255,255,0.55);
      background:
        linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
      backdrop-filter: blur(60px) saturate(220%);
      -webkit-backdrop-filter: blur(60px) saturate(220%);
      box-shadow:
        0 30px 80px rgba(0,0,0,0.55),
        inset 0 1px 0 rgba(255,255,255,0.40);
      overflow: hidden;
      min-width: 170px;
    }
    .clock-glass::before{
      content:"";
      position:absolute; inset:-40%;
      background:
        radial-gradient(circle at 20% 25%, rgba(255,255,255,0.50) 0%, rgba(255,255,255,0.10) 22%, transparent 55%),
        linear-gradient(115deg, transparent 0%, rgba(255,255,255,0.18) 32%, rgba(255,255,255,0.02) 55%, transparent 70%);
      transform: rotate(8deg);
      filter: blur(10px);
      opacity: 0.9;
      animation: sunSweep 6.5s ease-in-out infinite;
      pointer-events:none;
    }
    .clock-glass::after{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.20), transparent 35%),
        radial-gradient(circle at 80% 20%, rgba(34,211,238,0.15), transparent 55%);
      mix-blend-mode: screen;
      pointer-events:none;
    }
    @keyframes sunSweep{
      0%,100%{ transform: translateX(-6%) rotate(8deg); opacity:0.75; }
      50%{ transform: translateX(8%) rotate(8deg); opacity:1; }
    }

    /* ===== CLICKABLE METRIC CARDS ===== */
    .metric-card{ cursor: pointer; }
    .metric-card:focus{ outline: none; box-shadow: 0 0 0 2px rgba(165,243,252,0.35), var(--glass-shadow); }
    .tap-hint{
      margin-top: 1.25rem;
      font-size: 0.75rem;
      letter-spacing: 1.4px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.55);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
    }
    .metric-card:hover .tap-hint{ border-color: rgba(255,255,255,0.25); }

    /* ===== DETAIL MODAL ===== */
    .detail-overlay{
      position: fixed; inset:0;
      display:none;
      align-items: center; justify-content: center;
      padding: 1.25rem;
      padding-bottom: calc(1.25rem + var(--safe-bottom));
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      z-index: 999;
    }
    .detail-overlay.active{ display:flex; animation: fadeUp 0.35s ease forwards; }
    .detail-modal{
      width: min(720px, 100%);
      padding: 1.6rem;
      border-radius: 34px;
      background: linear-gradient(135deg, rgba(255,255,255,0.12), rgba(255,255,255,0.03));
    }
    .detail-close{
      position:absolute;
      top: 14px; right: 14px;
      width: 44px; height: 44px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
      color: white;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer;
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
    }
    .detail-head{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap: 1rem; flex-wrap: wrap;
      padding-right: 54px;
    }
    .detail-title{
      font-size: clamp(1.4rem, 4.5vw, 2.2rem);
      font-weight: 800;
      letter-spacing: -1px;
      margin-top: 0.25rem;
    }
    .detail-readout{ text-align:right; min-width: 160px; }
    .detail-value{
      font-variant-numeric: tabular-nums;
      font-size: clamp(2rem, 7vw, 3rem);
      font-weight: 800;
      letter-spacing: -1px;
      color: rgba(255,255,255,0.98);
      text-shadow: 0 0 20px rgba(255,255,255,0.12);
    }
    .detail-sub{
      color: rgba(255,255,255,0.65);
      font-weight: 650;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-size: 0.78rem;
    }
    .detail-scene{
      position: relative;
      margin-top: 1.2rem;
      height: 260px;
      border-radius: 26px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(50px) saturate(200%);
      -webkit-backdrop-filter: blur(50px) saturate(200%);
    }
    .detail-notes{
      margin-top: 1rem;
      color: rgba(255,255,255,0.60);
      font-size: 0.95rem;
      line-height: 1.35;
    }

    /* ===== SCENES ===== */
    .scene-layer{ position:absolute; inset:0; }
    /* Humidity: water + mist */
    .scene-humidity .water{
      position:absolute; left:-20%; right:-20%; bottom:-35%;
      height: 70%;
      background:
        radial-gradient(circle at 20% 30%, rgba(165,243,252,0.35), transparent 55%),
        radial-gradient(circle at 70% 40%, rgba(56,189,248,0.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.08), rgba(56,189,248,0.10));
      filter: blur(0px);
      border-top: 1px solid rgba(255,255,255,0.22);
      transform: rotate(-2deg);
      animation: waterSway 6s ease-in-out infinite;
    }
    .scene-humidity .water::before{
      content:"";
      position:absolute; inset:-20% -10%;
      background:
        radial-gradient(circle at 10% 50%, rgba(255,255,255,0.10), transparent 55%),
        radial-gradient(circle at 60% 60%, rgba(255,255,255,0.08), transparent 55%);
      filter: blur(18px);
      opacity: 0.9;
      animation: mistDrift 7.5s ease-in-out infinite;
    }
    .scene-humidity .droplets{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 30%, rgba(255,255,255,0.25) 0 2px, transparent 3px),
        radial-gradient(circle at 35% 45%, rgba(255,255,255,0.20) 0 2px, transparent 3px),
        radial-gradient(circle at 55% 28%, rgba(255,255,255,0.22) 0 2px, transparent 3px),
        radial-gradient(circle at 70% 50%, rgba(255,255,255,0.18) 0 2px, transparent 3px),
        radial-gradient(circle at 82% 35%, rgba(255,255,255,0.22) 0 2px, transparent 3px);
      opacity: 0.55;
      animation: dropletPulse 2.8s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes waterSway{ 0%,100%{ transform: translateX(0) rotate(-2deg); } 50%{ transform: translateX(6%) rotate(-2deg); } }
    @keyframes mistDrift{ 0%,100%{ transform: translateX(-3%); opacity:0.7; } 50%{ transform: translateX(4%); opacity:1; } }
    @keyframes dropletPulse{ 0%,100%{ opacity:0.35; } 50%{ opacity:0.65; } }

    /* Pressure: gauge + silhouettes */
    .scene-pressure .sky{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,0.18), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(165,243,252,0.12), transparent 60%),
        linear-gradient(180deg, rgba(30,27,75,0.55), rgba(0,0,0,0.25));
    }
    .scene-pressure .horizon{
      position:absolute; left:-10%; right:-10%; bottom:-15%;
      height: 55%;
      background:
        linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.55)),
        radial-gradient(circle at 40% 60%, rgba(255,255,255,0.06), transparent 55%);
      filter: blur(0px);
      transform: translateX(0);
      animation: horizonPan 8s ease-in-out infinite;
    }
    .scene-pressure .silhouettes{
      position:absolute; left:0; right:0; bottom:22px; height: 90px;
      opacity: 0.55;
      background:
        linear-gradient(to top, rgba(0,0,0,0.55), transparent 70%),
        radial-gradient(circle at 12% 80%, rgba(0,0,0,0.7) 0 22px, transparent 23px),
        radial-gradient(circle at 18% 75%, rgba(0,0,0,0.7) 0 18px, transparent 19px),
        radial-gradient(circle at 25% 78%, rgba(0,0,0,0.7) 0 26px, transparent 27px),
        radial-gradient(circle at 65% 82%, rgba(0,0,0,0.7) 0 14px, transparent 15px),
        radial-gradient(circle at 72% 80%, rgba(0,0,0,0.7) 0 18px, transparent 19px);
      filter: blur(1px);
      animation: silhouettesDrift 6.2s ease-in-out infinite;
    }
    .scene-pressure .gauge{
      position:absolute; top:18px; right:18px;
      width: 150px; height: 150px; border-radius: 50%;
      border: 1px solid rgba(255,255,255,0.22);
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.18), rgba(255,255,255,0.04) 55%, rgba(255,255,255,0.02));
      backdrop-filter: blur(35px);
      -webkit-backdrop-filter: blur(35px);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.35), 0 20px 50px rgba(0,0,0,0.35);
      overflow:hidden;
    }
    .scene-pressure .needle{
      position:absolute; left:50%; top:50%;
      width: 2px; height: 58px;
      background: rgba(165,243,252,0.9);
      transform-origin: bottom;
      transform: translate(-50%,-100%) rotate(-25deg);
      filter: drop-shadow(0 0 12px rgba(165,243,252,0.65));
      animation: needleSwing 4.8s ease-in-out infinite;
    }
    .scene-pressure .gauge::after{
      content:"";
      position:absolute; inset:10px;
      border-radius: 50%;
      border: 1px dashed rgba(255,255,255,0.18);
      opacity: 0.75;
    }
    @keyframes needleSwing{ 0%,100%{ transform: translate(-50%,-100%) rotate(-22deg);} 50%{ transform: translate(-50%,-100%) rotate(22deg);} }
    @keyframes silhouettesDrift{ 0%,100%{ transform: translateX(-2%);} 50%{ transform: translateX(3%);} }
    @keyframes horizonPan{ 0%,100%{ transform: translateX(-1%);} 50%{ transform: translateX(2%);} }

    /* Visibility: fog density + headlight beams */
    .scene-visibility .fog{
      position:absolute; inset:-10%;
      background:
        radial-gradient(circle at 25% 40%, rgba(255,255,255,0.14), transparent 55%),
        radial-gradient(circle at 65% 45%, rgba(255,255,255,0.12), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0.18));
      filter: blur(12px);
      opacity: 0.9;
      animation: fogBreath 5.6s ease-in-out infinite;
    }
    .scene-visibility .road{
      position:absolute; left:0; right:0; bottom:0; height: 45%;
      background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.65));
    }
    .scene-visibility .car{
      position:absolute; left: 18px; bottom: 28px;
      width: 84px; height: 32px; border-radius: 14px;
      background: rgba(0,0,0,0.55);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 18px 40px rgba(0,0,0,0.35);
      animation: carCreep 6.8s ease-in-out infinite;
    }
    .scene-visibility .beam{
      position:absolute; left: 70px; bottom: 40px;
      width: 240px; height: 120px;
      background: conic-gradient(from 220deg at 0% 80%, rgba(255,255,255,0.26), rgba(255,255,255,0.02), transparent 55%);
      filter: blur(8px);
      opacity: 0.7;
      transform: skewX(-10deg);
      animation: beamFlicker 2.6s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes fogBreath{ 0%,100%{ opacity:0.95; transform: translateX(-1%);} 50%{ opacity:0.75; transform: translateX(2%);} }
    @keyframes beamFlicker{ 0%,100%{ opacity:0.65;} 50%{ opacity:0.85;} }
    @keyframes carCreep{ 0%,100%{ transform: translateX(0);} 50%{ transform: translateX(18px);} }

    @media (max-width: 768px){
      .clock-glass{ min-width: 150px; padding: 0.75rem 0.9rem; }
      .detail-scene{ height: 240px; }
    }

    /* =========================================================
       FIXED: CELESTIAL SPLIT SUNRISE / SUNSET (ONLY THIS AREA)
       ========================================================= */
    .celestial-split{
      grid-column: 1 / -1;
      padding: 0;
      overflow: hidden;
    }
    .celestial-wrap{
      position: relative;
      height: 260px;
      border-radius: var(--radius-lg);
      overflow: hidden;
      border: 1px solid var(--glass-border);
      border-top: 1px solid rgba(255,255,255,0.35);
      background: linear-gradient(135deg, rgba(255,255,255,0.10), rgba(255,255,255,0.02));
      backdrop-filter: blur(55px) saturate(190%);
      -webkit-backdrop-filter: blur(55px) saturate(190%);
      box-shadow: var(--glass-shadow);
    }
    @media (max-width:768px){ .celestial-wrap{ height: 240px; } }

    .celestial-bg{
      position:absolute; inset:0;
      transition: opacity .6s ease;
    }
    .celestial-bg.day{
      background:
        radial-gradient(160px 140px at 70% 22%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(260px 220px at 72% 18%, rgba(255,200,120,.40), transparent 70%),
        linear-gradient(180deg, rgba(120,195,255,.50), rgba(35,65,120,.22) 55%, rgba(0,0,0,.20));
    }
    .celestial-bg.twilight{
      background:
        radial-gradient(240px 200px at 55% 18%, rgba(255,170,110,.30), transparent 70%),
        radial-gradient(260px 220px at 40% 15%, rgba(160,120,255,.22), transparent 75%),
        linear-gradient(180deg, rgba(90,80,160,.55), rgba(15,18,42,.55) 60%, rgba(0,0,0,.38));
    }
    .celestial-bg.night{
      background:
        radial-gradient(240px 220px at 70% 18%, rgba(160,195,255,.28), transparent 72%),
        linear-gradient(180deg, rgba(18,22,52,.78), rgba(8,10,22,.60) 60%, rgba(0,0,0,.45));
    }

    .celestial-stars{
      position:absolute; inset:0; pointer-events:none;
      opacity: 0; transition: opacity .7s ease;
      background-image:
        radial-gradient(1px 1px at 12% 22%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(1px 1px at 28% 38%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(1px 1px at 48% 18%, rgba(255,255,255,.55), transparent 60%),
        radial-gradient(1px 1px at 66% 28%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(1px 1px at 82% 22%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(1px 1px at 18% 70%, rgba(255,255,255,.35), transparent 60%),
        radial-gradient(1px 1px at 72% 74%, rgba(255,255,255,.45), transparent 60%),
        radial-gradient(1px 1px at 88% 60%, rgba(255,255,255,.35), transparent 60%);
      animation: twinkle 3.6s ease-in-out infinite;
    }

    .celestial-splitgrid{
      position:absolute; inset:0;
      display:grid;
      grid-template-columns: 1fr 1fr;
    }
    .celestial-pane{
      position:relative;
      overflow:hidden;
    }
    .celestial-divider{
      position:absolute; top:0; bottom:0; left:50%;
      width:1px; transform: translateX(-.5px);
      background: rgba(255,255,255,0.16);
      box-shadow: 0 0 18px rgba(255,255,255,0.08);
      pointer-events:none;
    }

    /* Ocean */
    .celestial-ocean{
      position:absolute; left:-12%; right:-12%; bottom:-18%;
      height: 58%;
      background:
        radial-gradient(180px 60px at 18% 10%, rgba(255,255,255,.18), transparent 70%),
        radial-gradient(220px 70px at 70% 18%, rgba(255,255,255,.14), transparent 72%),
        linear-gradient(180deg, rgba(30,90,150,.18), rgba(0,0,0,.32));
      border-top: 1px solid rgba(255,255,255,.18);
    }
    .celestial-ocean::before{
      content:"";
      position:absolute; inset:-20% -10%;
      background: repeating-linear-gradient(110deg,
        rgba(255,255,255,.10) 0px,
        rgba(255,255,255,.10) 6px,
        rgba(255,255,255,0) 12px,
        rgba(255,255,255,0) 28px
      );
      opacity:.35;
      transform: translateX(-6%);
      animation: waveDrift 6.5s ease-in-out infinite;
    }

    /* Sun */
    .celestial-sun{
      position:absolute;
      width: 78px; height:78px;
      border-radius: 999px;
      left: 50%;
      transform: translateX(-50%);
      top: 72%;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.85), rgba(255,255,255,0) 40%),
        radial-gradient(circle at 45% 40%, rgba(255,235,175,.95), rgba(255,190,95,.75) 45%, rgba(255,160,50,0) 78%);
      box-shadow:
        0 0 42px rgba(255,200,120,.45),
        0 0 90px rgba(255,170,70,.20);
      opacity: 1;
    }

    /* Sunrise / Sunset motion (scoped) */
    @keyframes celestialRise{
      0%{ top: 86%; opacity: 0; transform: translateX(-50%) scale(.94); }
      12%{ opacity: 1; }
      55%{ top: 30%; transform: translateX(-50%) scale(1.0); opacity:1; }
      100%{ top: 20%; transform: translateX(-50%) scale(1.02); opacity:1; }
    }
    @keyframes celestialSet{
      0%{ top: 20%; opacity:1; transform: translateX(-50%) scale(1.02); }
      55%{ top: 34%; transform: translateX(-50%) scale(1.0); opacity:1; }
      88%{ opacity: 1; }
      100%{ top: 90%; opacity: 0; transform: translateX(-50%) scale(.94); }
    }
    .pane-sunrise .celestial-sun{ animation: celestialRise 6.0s ease-in-out infinite alternate; }
    .pane-sunset  .celestial-sun{ animation: celestialSet  6.6s ease-in-out infinite alternate; }

    /* light rays */
    .celestial-rays{
      position:absolute; inset:-35% -45%;
      pointer-events:none;
      background: conic-gradient(from 210deg at 70% 24%,
        rgba(255,255,255,0),
        rgba(255,255,255,.16),
        rgba(255,255,255,0) 55%,
        rgba(255,255,255,.10),
        rgba(255,255,255,0) 78%,
        rgba(255,255,255,0)
      );
      mix-blend-mode: screen;
      opacity:.50;
      filter: blur(7px);
      transform: rotate(-10deg);
      animation: raysSweep 6.8s ease-in-out infinite;
    }

    /* Labels inside split */
    .celestial-label{
      position:absolute; top:14px; left:14px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 750;
      letter-spacing: 1.2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.78);
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.16);
      backdrop-filter: blur(18px);
      -webkit-backdrop-filter: blur(18px);
    }
    .celestial-time{
      position:absolute; top: 54px; left: 14px;
      font-size: clamp(1.8rem, 4.5vw, 2.6rem);
      font-weight: 800;
      letter-spacing: -1px;
      font-variant-numeric: tabular-nums;
      text-shadow: 0 0 18px rgba(255,255,255,0.10);
    }
  </style>
</head>
<body>

  <div class="app-bg" id="app-bg"></div>
  <div class="app-noise"></div>

  <div class="app-container">
    <nav class="sidebar">
      <div class="nav-logo"><i class="ph-fill ph-planet"></i></div>
      <button class="nav-item active" onclick="switchTab('dashboard', this)">
        <i class="ph-bold ph-squares-four"></i>
      </button>
      <button class="nav-item" onclick="switchTab('wind', this)">
        <i class="ph-bold ph-wind"></i>
      </button>
      <button class="nav-item" onclick="switchTab('radar', this)">
        <i class="ph-bold ph-radar"></i>
      </button>
      <button class="nav-item" onclick="switchTab('astro', this)">
        <i class="ph-bold ph-sun-horizon"></i>
      </button>
      <div class="spacer" style="flex:1"></div>
      <button class="nav-item" onclick="switchTab('settings', this)">
        <i class="ph-bold ph-gear"></i>
      </button>
    </nav>

    <main class="main-content">

      <section id="view-dashboard" class="view-section active">
        <header class="view-header">
          <div class="view-title">
            <span>NetWatch Broadcast System</span>
            <h1>System Overview</h1>
          </div>
          <div class="header-right">
             <div class="search-box">
                <i class="ph-bold ph-magnifying-glass"></i>
                <input type="text" id="zip-search" placeholder="Zip Code..." onkeydown="handleSearch(event)">
             </div>
             <div class="clock-glass" role="group" aria-label="System clock">
               <div class="clock-widget">
                  <div class="clock-time" id="clock-time">--:--:--</div>
                  <div class="clock-date" id="clock-date">--</div>
               </div>
             </div>
          </div>
        </header>

        <div class="grid-dashboard">
          <div class="glass-card hero-card">
            <div>
              <div style="font-size:1.1rem; opacity:0.8; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                <i class="ph-fill ph-map-pin"></i> <span id="loc-name">Locating...</span>
              </div>
              <div id="val-temp">--°</div>
              <div style="color:var(--accent); margin-top:0.5rem; font-size:1.4rem; font-weight:600;" id="val-cond">--</div>
            </div>

            <div class="weather-icon-stage" id="icon-stage">
               <div class="glass-cloud"></div>
            </div>
          </div>

          <div class="glass-card metric-card" data-metric="humidity" tabindex="0" role="button" aria-label="Humidity details">
            <div class="metric-label">Humidity</div>
            <div class="metric-val" id="val-humid">--%</div>
            <div class="metric-sub">Dew Point: <span id="val-dew">--</span>°</div>
            <div class="tap-hint">Tap for details</div>
          </div>
          <div class="glass-card metric-card" data-metric="pressure" tabindex="0" role="button" aria-label="Pressure details">
            <div class="metric-label">Pressure</div>
            <div class="metric-val" id="val-press">--</div>
            <div class="metric-sub" style="font-size:1rem">hPa</div>
            <div class="tap-hint">Tap for details</div>
          </div>
          <div class="glass-card metric-card" data-metric="visibility" tabindex="0" role="button" aria-label="Visibility details">
            <div class="metric-label">Visibility</div>
            <div class="metric-val" id="val-vis">--</div>
            <div class="metric-sub" style="font-size:1rem">Miles</div>
            <div class="tap-hint">Tap for details</div>
          </div>
        </div>
      </section>

      <section id="view-wind" class="view-section">
        <header class="view-header"><div class="view-title"><span>Simulation</span><h1>Live Ocean</h1></div></header>
        <div class="glass-card" style="padding:0; height:400px; position:relative; overflow:hidden;">
           <div class="ocean-scene" id="ocean-scene" style="height:100%; width:100%; border:none;">
              <div class="wave"></div><div class="wave"></div>
              <div style="position:absolute; bottom:-20px; right:20px; width:200px; animation: sway 3s ease-in-out infinite alternate;">
                 <svg viewBox="0 0 200 300" fill="none"><path d="M98 300C86 248 84 205 88 160C92 110 110 60 120 0" stroke="rgba(0,0,0,0.4)" stroke-width="10" stroke-linecap="round"/><path d="M118 22C150 30 180 52 196 78" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 35C145 55 165 78 178 105" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/><path d="M118 22C85 35 55 58 25 86" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 40C90 60 70 85 52 112" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/></svg>
              </div>
              <div style="position:absolute; bottom:20px; left:20px; z-index:10;">
                 <div style="font-size:4rem; font-weight:800; line-height:1" id="wind-big">--</div>
                 <div style="font-weight:700; opacity:0.8; letter-spacing:2px">MPH WIND</div>
              </div>
           </div>
        </div>
      </section>

      <section id="view-radar" class="view-section">
        <header class="view-header"><div class="view-title"><span>Map</span><h1>Live Radar</h1></div></header>
        <div style="width:100%; height:60vh; border-radius:32px; overflow:hidden; border:1px solid var(--glass-border);" id="radar-container">
           <div style="height:100%; display:flex; align-items:center; justify-content:center;">Loading Radar...</div>
        </div>
      </section>

      <section id="view-astro" class="view-section">
         <header class="view-header"><div class="view-title"><span>Celestial</span><h1>Sun & Moon</h1></div></header>
         <div class="grid-dashboard">
            <!-- Kept your original sunrise/sunset values/IDs, just upgraded the visual layout -->
            <div class="glass-card celestial-split">
              <div class="celestial-wrap" id="celestial-wrap">
                <div class="celestial-bg day" id="celestial-bg"></div>
                <div class="celestial-stars" id="celestial-stars"></div>

                <div class="celestial-splitgrid">
                  <div class="celestial-pane pane-sunrise">
                    <div class="celestial-rays"></div>
                    <div class="celestial-label">Sunrise</div>
                    <div class="celestial-time" id="val-rise">--</div>
                    <div class="celestial-sun" aria-hidden="true"></div>
                    <div class="celestial-ocean" aria-hidden="true"></div>
                  </div>

                  <div class="celestial-pane pane-sunset">
                    <div class="celestial-rays"></div>
                    <div class="celestial-label">Sunset</div>
                    <div class="celestial-time" id="val-set">--</div>
                    <div class="celestial-sun" aria-hidden="true"></div>
                    <div class="celestial-ocean" aria-hidden="true"></div>
                  </div>
                </div>

                <div class="celestial-divider" aria-hidden="true"></div>
              </div>
            </div>
         </div>
      </section>


      <!-- ===== METRIC DETAIL MODAL ===== -->
      <div class="detail-overlay" id="detail-overlay" aria-hidden="true">
        <div class="detail-modal glass-card" role="dialog" aria-modal="true" aria-labelledby="detail-title">
          <button class="detail-close" id="detail-close" aria-label="Close details">
            <i class="ph-bold ph-x"></i>
          </button>

          <div class="detail-head">
            <div>
              <div class="metric-label" id="detail-kicker">Metric</div>
              <div class="detail-title" id="detail-title">Details</div>
            </div>
            <div class="detail-readout">
              <div class="detail-value" id="detail-value">--</div>
              <div class="detail-sub" id="detail-sub">--</div>
            </div>
          </div>

          <div class="detail-scene" id="detail-scene">
            <!-- injected -->
          </div>

          <div class="detail-notes" id="detail-notes">
            Tap different cards for different “forecast feel” visuals.
          </div>
        </div>
      </div>

    </main>
  </div>

  <script>
    // ===== STATE =====
    let lat = null, lon = null;
    const ui = {
      loc: document.getElementById('loc-name'),
      temp: document.getElementById('val-temp'),
      cond: document.getElementById('val-cond'),
      humid: document.getElementById('val-humid'),
      dew: document.getElementById('val-dew'),
      press: document.getElementById('val-press'),
      vis: document.getElementById('val-vis'),
      windBig: document.getElementById('wind-big'),
      radar: document.getElementById('radar-container'),
      iconStage: document.getElementById('icon-stage'),
      rise: document.getElementById('val-rise'),
      set: document.getElementById('val-set')
    };

    // ===== CLOCK =====
    function updateClock() {
        const now = new Date();
        document.getElementById('clock-time').textContent = now.toLocaleTimeString('en-US', {hour12: false});
        document.getElementById('clock-date').textContent = now.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
    }
    setInterval(updateClock, 1000); updateClock();

    // ===== INIT =====
    function initApp() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => { lat = pos.coords.latitude; lon = pos.coords.longitude; fetchLocationName(lat, lon); },
          () => { console.warn("GPS Denied. IP Fallback."); getLocationByIP(); }
        );
      } else { getLocationByIP(); }
    }

    async function fetchLocationName(lat, lon) {
        try {
            // Uses BigDataCloud Free API for Reverse Geocoding (City, State)
            const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
            const data = await res.json();
            ui.loc.textContent = `${data.city}, ${data.principalSubdivisionCode}`;
            fetchWeather();
        } catch(e) { ui.loc.textContent = "Current Location"; fetchWeather(); }
    }

    async function getLocationByIP() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        lat = data.latitude; lon = data.longitude;
        ui.loc.textContent = `${data.city}, ${data.region_code}`;
        fetchWeather();
      } catch (e) { ui.loc.textContent = "Location Unknown"; }
    }

    async function handleSearch(e) {
        if(e.key === 'Enter') {
            const zip = document.getElementById('zip-search').value;
            // Placeholder: In real app, call API to convert Zip -> Lat/Lon
            alert("Searching DB for: " + zip);
        }
    }

    // ===== WEATHER FETCH =====
    async function fetchWeather() {
      if (!lat || !lon) return;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,visibility,pressure_msl,dewpoint_2m&daily=sunrise,sunset&windspeed_unit=mph&temperature_unit=fahrenheit&timezone=auto`;

      try {
        const res = await fetch(url);
        const data = await res.json();
        const curr = data.current_weather;

        ui.temp.textContent = Math.round(curr.temperature) + "°";
        ui.cond.textContent = getWeatherDesc(curr.weathercode);
        ui.windBig.textContent = Math.round(curr.windspeed);

        ui.humid.textContent = data.hourly.relativehumidity_2m[0] + "%";
        ui.dew.textContent = Math.round(data.hourly.dewpoint_2m[0]);
        ui.press.textContent = Math.round(data.hourly.pressure_msl[0]);
        ui.vis.textContent = (data.hourly.visibility[0] / 1609).toFixed(1);

        // Keep your original IDs/behavior:
        ui.rise.textContent = data.daily.sunrise[0].slice(-5);
        ui.set.textContent = data.daily.sunset[0].slice(-5);

        renderIcon(curr.weathercode, curr.is_day);

        // Load Radar
        ui.radar.innerHTML = `<iframe src="https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&width=650&height=450&zoom=10&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1" width="100%" height="100%" frameborder="0"></iframe>`;

        // Update celestial background mode based on is_day and proximity to sunrise/sunset (simple + stable)
        updateCelestialMode(curr.is_day, ui.rise.textContent, ui.set.textContent);

      } catch(e) { console.error(e); }
    }

    function updateCelestialMode(isDay, sunriseHHMM, sunsetHHMM){
      const bg = document.getElementById('celestial-bg');
      const stars = document.getElementById('celestial-stars');
      if(!bg || !stars) return;

      // default day/night based on API
      let mode = isDay ? 'day' : 'night';

      // twilight window around sunrise/sunset
      const now = new Date();
      const nowMin = now.getHours()*60 + now.getMinutes();
      function parseHM(hm){
        const parts = String(hm||'').split(':');
        if(parts.length !== 2) return null;
        const h = parseInt(parts[0],10), m = parseInt(parts[1],10);
        if(Number.isNaN(h)||Number.isNaN(m)) return null;
        return h*60+m;
      }
      const rise = parseHM(sunriseHHMM);
      const set = parseHM(sunsetHHMM);
      const tw = 35;

      if(rise !== null && Math.abs(nowMin - rise) <= tw) mode = 'twilight';
      if(set  !== null && Math.abs(nowMin - set)  <= tw) mode = 'twilight';

      bg.classList.remove('day','twilight','night');
      bg.classList.add(mode);
      stars.style.opacity = (mode === 'night') ? '1' : '0';
    }

    // ===== RENDER ICON & DESC =====
    function renderIcon(code, isDay) {
        const stage = ui.iconStage;
        let html = `<div class="glass-cloud"></div>`;

        if (code < 3) { // Sunny/Clear
            html += `<div class="sun-glare" style="opacity:${isDay?0.8:0.3}; background:${isDay?'radial-gradient(circle, #fbbf24 0%, transparent 70%)':'radial-gradient(circle, #f8fafc 0%, transparent 70%)'}"></div>`;
        }

        if (code > 50) { // Rain
            for(let i=0; i<5; i++) {
                html += `<div class="rain-drop" style="left:${20 + i*15}px; animation-delay:${i*0.2}s"></div>`;
            }
        }

        if (code >= 95) { // Storm
            html += `<div class="lightning-bolt bolt-anim"></div>`;
        }
        stage.innerHTML = html;
    }

    function getWeatherDesc(code) {
      if(code === 0) return "Clear Sky";
      if(code < 4) return "Partly Cloudy";
      if(code < 50) return "Foggy";
      if(code < 80) return "Rain";
      return "Thunderstorm";
    }

    function switchTab(id, btn) {
      document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
      document.getElementById('view-'+id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
      btn.classList.add('active');
    }


    // ===== METRIC DETAILS (GLASSY VISUALS) =====
    const overlay = document.getElementById('detail-overlay');
    const closeBtn = document.getElementById('detail-close');
    const scene = document.getElementById('detail-scene');
    const titleEl = document.getElementById('detail-title');
    const kickerEl = document.getElementById('detail-kicker');
    const valEl = document.getElementById('detail-value');
    const subEl = document.getElementById('detail-sub');
    const notesEl = document.getElementById('detail-notes');

    function openDetail(metric){
      const map = {
        humidity: {
          kicker: "Humidity",
          title: "Moisture & Dew",
          value: () => document.getElementById('val-humid')?.textContent || "--",
          sub: () => `Dew Point: ${document.getElementById('val-dew')?.textContent || "--"}°`,
          notes: "High humidity can mean fog, haze, or a sticky feel. The water + mist visual ramps up with moisture."
        },
        pressure: {
          kicker: "Pressure",
          title: "Atmospheric Load",
          value: () => (document.getElementById('val-press')?.textContent || "--") + " hPa",
          sub: () => "Swinging needle = rising/falling pressure vibe",
          notes: "Pressure trends influence storms, wind, and stability. The gauge + horizon gives you that ‘what’s coming’ impression."
        },
        visibility: {
          kicker: "Visibility",
          title: "Fog & Distance",
          value: () => (document.getElementById('val-vis')?.textContent || "--") + " mi",
          sub: () => "Fog breath + headlight beam",
          notes: "Lower visibility often comes with fog, haze, smoke, or heavy precipitation. The fog density pulses to suggest changing clarity."
        }
      };

      const cfg = map[metric];
      if(!cfg) return;

      kickerEl.textContent = cfg.kicker;
      titleEl.textContent = cfg.title;
      valEl.textContent = cfg.value();
      subEl.textContent = cfg.sub();
      notesEl.textContent = cfg.notes;

      // Scene templates
      let sceneHTML = "";
      scene.className = "detail-scene"; // reset
      if(metric === "humidity"){
        scene.classList.add("scene-humidity");
        sceneHTML = `
          <div class="scene-layer droplets"></div>
          <div class="scene-layer water"></div>
        `;
      }
      if(metric === "pressure"){
        scene.classList.add("scene-pressure");
        sceneHTML = `
          <div class="scene-layer sky"></div>
          <div class="scene-layer horizon"></div>
          <div class="scene-layer silhouettes"></div>
          <div class="gauge">
            <div class="needle"></div>
          </div>
        `;
      }
      if(metric === "visibility"){
        scene.classList.add("scene-visibility");
        sceneHTML = `
          <div class="scene-layer fog"></div>
          <div class="scene-layer road"></div>
          <div class="car"></div>
          <div class="beam"></div>
        `;
      }
      scene.innerHTML = sceneHTML;

      overlay.classList.add('active');
      overlay.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeDetail(){
      overlay.classList.remove('active');
      overlay.setAttribute('aria-hidden', 'true');
      scene.innerHTML = "";
      document.body.style.overflow = '';
    }

    function wireMetricCards(){
      document.querySelectorAll('.metric-card').forEach(card => {
        const metric = card.getAttribute('data-metric');
        const go = () => openDetail(metric);
        card.addEventListener('click', go);
        card.addEventListener('keydown', (e) => {
          if(e.key === 'Enter' || e.key === ' '){ e.preventDefault(); go(); }
        });
      });
    }

    overlay.addEventListener('click', (e) => { if(e.target === overlay) closeDetail(); });
    closeBtn.addEventListener('click', closeDetail);
    window.addEventListener('keydown', (e) => { if(e.key === 'Escape' && overlay.classList.contains('active')) closeDetail(); });


    // Start App
    wireMetricCards();
    initApp();
  </script>
</body>
</html>
