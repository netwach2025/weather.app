<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NetWatch Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <style>
    /* =========================================
       NETWATCH PRO: RESPONSIVE ENGINE
       ========================================= */
    :root {
      --bg-deep: #000000;
      --accent: #a5f3fc;
      --text-main: #ffffff;
      --text-muted: rgba(255, 255, 255, 0.6);
      
      --glass-surface: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.18);
      --glass-highlight: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      
      --radius-lg: 32px;
      --radius-pill: 999px;
      --sidebar-width: 88px;
      
      /* Safe Area Variables for iPhone Notch/Home Bar */
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; width: 100vw; height: 100vh;
      background: #000;
      color: var(--text-main);
      font-family: 'Inter', sans-serif;
      overflow: hidden;
    }

    /* ===== BACKGROUND ===== */
    .app-bg {
      position: fixed; inset: 0; z-index: -2;
      background: radial-gradient(circle at 50% 0%, #1e1b4b, #0f172a, #000);
      transition: background 2s ease;
    }
    .app-noise {
      position: fixed; inset: 0; z-index: -1; opacity: 0.07; pointer-events: none;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIj48ZmlsdGVyIGlkPSJuIj48ZmVUdXJidWxlbmNlIHR5cGU9ImZyYWN0YWxOb2lzZSIgYmFzZUZyZXF1ZW5jeT0iMC44IiBzdGl0Y2hUaWxlcz0ic3RpdGNoIi8+PC9maWx0ZXI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI24pIiBvcGFjaXR5PSIwLjUiLz48L3N2Zz4=');
    }

    .app-container { display: flex; height: 100vh; width: 100vw; }

    /* ===== RESPONSIVE SIDEBAR / BOTTOM NAV ===== */
    .sidebar {
      width: var(--sidebar-width); height: 100%;
      background: rgba(10, 10, 10, 0.4);
      backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
      border-right: 1px solid var(--glass-border);
      display: flex; flex-direction: column; align-items: center;
      padding: 2.5rem 0; gap: 1.5rem; z-index: 100;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .nav-logo { font-size: 2rem; color: var(--accent); margin-bottom: 2rem; filter: drop-shadow(0 0 15px rgba(34,211,238,0.6)); }

    .nav-item {
      position: relative; width: 56px; height: 56px;
      border-radius: 20px; display: flex; align-items: center; justify-content: center;
      color: var(--text-muted); font-size: 1.6rem; cursor: pointer;
      border: none; background: transparent; transition: all 0.2s;
    }
    .nav-item:hover, .nav-item.active {
      color: #fff; background: rgba(255,255,255,0.1);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
    }
    .nav-item.active i { color: var(--accent); }
    
    /* Mobile-Only Nav Adjustments */
    @media (max-width: 768px) {
      .app-container { flex-direction: column-reverse; } /* Move sidebar to bottom */
      
      .sidebar {
        width: 100%; 
        height: calc(70px + var(--safe-bottom)); /* Dynamic height for iPhone Home Bar */
        flex-direction: row; 
        justify-content: space-evenly;
        padding: 10px 10px calc(10px + var(--safe-bottom)) 10px;
        border-right: none;
        border-top: 1px solid var(--glass-border);
        background: rgba(10, 10, 10, 0.85); /* Darker on mobile for contrast */
      }
      .nav-logo { display: none; }
      .nav-item { width: 48px; height: 48px; font-size: 1.4rem; }
      .nav-item .tooltip { display: none !important; } /* No tooltips on touch */
      
      /* Hide settings on mobile to save space if needed, or keep it */
      .spacer { display: none; } 
    }

    /* ===== MAIN CONTENT ===== */
    .main-content { 
      flex: 1; 
      padding: 2.5rem; 
      padding-top: calc(2rem + var(--safe-top)); /* Status bar spacing */
      overflow-y: auto; 
      position: relative; 
      scroll-behavior: smooth;
    }

    /* Transitions */
    .view-section { display: none; animation: fadeUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
    .view-section.active { display: block; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

    /* HEADER */
    .view-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 2.5rem; flex-wrap: wrap; gap: 1rem;
    }
    .view-title h1 { 
      margin: 0; font-weight: 800; font-size: clamp(2rem, 5vw, 3.5rem); /* Liquid Font Size */
      letter-spacing: -1.5px;
      background: linear-gradient(180deg, #fff 0%, #cbd5e1 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .view-title span { color: var(--accent); font-size: 0.85rem; text-transform: uppercase; letter-spacing: 3px; font-weight: 700; display: block; margin-bottom: 5px; }

    .header-right { display: flex; align-items: center; gap: 1.5rem; }

    /* SEARCH BAR */
    .search-box {
      position: relative; display: flex; align-items: center;
      background: rgba(255,255,255,0.08); border: 1px solid var(--glass-border);
      border-radius: var(--radius-pill); padding: 0.6rem 1.2rem;
      transition: all 0.3s ease;
    }
    .search-box input {
      background: transparent; border: none; color: white; outline: none;
      width: 140px; font-size: 1rem; margin-left: 0.75rem; font-weight: 500;
    }
    .search-box i { color: var(--accent); font-size: 1.2rem; }

    .clock-widget { text-align: right; }
    .clock-time { font-size: 1.8rem; font-weight: 200; line-height: 1; font-variant-numeric: tabular-nums; }
    .clock-date { font-size: 0.8rem; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

    /* ===== RESPONSIVE GRID ===== */
    .grid-dashboard { 
      display: grid; 
      /* Auto-fit columns: Sticks to 1 column on mobile, 2-3 on tablet/desktop */
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
      gap: 1.5rem; 
    }
    
    /* GLASS CARD */
    .glass-card {
      position: relative;
      background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.01) 100%);
      border: 1px solid var(--glass-border);
      border-top: 1px solid var(--glass-highlight);
      border-radius: var(--radius-lg);
      padding: 2rem;
      backdrop-filter: blur(50px) saturate(180%);
      -webkit-backdrop-filter: blur(50px) saturate(180%);
      box-shadow: var(--glass-shadow);
      overflow: hidden;
    }

    /* HERO CARD SPECIFIC */
    .hero-card {
      grid-column: 1 / -1; min-height: 320px;
      display: flex; align-items: center; justify-content: space-between;
      padding: 2rem 4rem;
      background: linear-gradient(120deg, rgba(255,255,255,0.1), rgba(255,255,255,0.02));
    }

    /* Dynamic Fonts inside cards */
    .metric-label { font-size: 0.85rem; font-weight: 700; letter-spacing: 1.5px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 0.5rem; }
    .metric-val { font-size: 3rem; font-weight: 700; letter-spacing: -1px; }
    
    /* Massive Hero Temp with Clamp */
    #val-temp {
      font-size: clamp(4rem, 10vw, 7rem); /* Scales smoothly from mobile to desktop */
      font-weight: 800; line-height:1; letter-spacing: -4px;
    }

    /* ===== WEATHER ICON ENGINE ===== */
    .weather-icon-stage { position: relative; width: 200px; height: 200px; transform: scale(1); }
    
    /* Cloud & Sun CSS Animations (Same as before but responsive scale) */
    .glass-cloud {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      width: 140px; height: 70px;
      background: rgba(255, 255, 255, 0.45); border-radius: 60px;
      backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
      box-shadow: inset 0 2px 4px rgba(255,255,255,0.8), 0 15px 30px rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.6); z-index: 10;
      animation: float 6s ease-in-out infinite;
    }
    .glass-cloud::after {
      content: ''; position: absolute; width: 80px; height: 80px;
      top: -45px; left: 25px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit; border-top: 1px solid rgba(255,255,255,0.6);
    }
    .glass-cloud::before {
      content: ''; position: absolute; width: 60px; height: 60px;
      top: -25px; left: 70px; background: inherit; border-radius: 50%;
      box-shadow: inherit; backdrop-filter: inherit;
    }
    @keyframes float { 0%, 100% { transform: translate(-50%, -50%); } 50% { transform: translate(-50%, -60%); } }

    .sun-glare {
      position: absolute; top: 10px; right: 20px; width: 90px; height: 90px;
      background: radial-gradient(circle, #fbbf24 0%, #f59e0b 40%, transparent 80%);
      border-radius: 50%; filter: blur(10px); opacity: 0; z-index: 5;
      animation: pulse-sun 4s ease-in-out infinite;
    }
    @keyframes pulse-sun { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

    .lightning-bolt {
      position: absolute; top: 60%; left: 50%; width: 0; height: 0;
      border-left: 10px solid transparent; border-right: 15px solid transparent; border-top: 40px solid #fef08a;
      transform: translateX(-50%) skew(-20deg); filter: drop-shadow(0 0 15px #facc15); opacity: 0; z-index: 8;
    }
    .bolt-anim { animation: flash 3s infinite; }
    @keyframes flash { 0%, 90%, 100% { opacity: 0; } 92% { opacity: 1; } 94% { opacity: 0; } 96% { opacity: 1; } }

    .rain-drop {
      position: absolute; background: #a5f3fc; width: 3px; height: 15px;
      border-radius: 2px; opacity: 0; top: 60%; animation: rain 1s linear infinite;
    }
    @keyframes rain { 0% { opacity: 0; transform: translateY(0); } 20% { opacity: 1; } 100% { opacity: 0; transform: translateY(60px); } }

    /* ===== MOBILE BREAKPOINTS ===== */
    @media (max-width: 768px) {
      /* Adjust Layout */
      .main-content { padding: 1.5rem; padding-bottom: 120px; } /* Extra bottom padding for nav */
      
      /* Stack Header items */
      .header-right { width: 100%; justify-content: space-between; margin-top: 1rem; }
      .search-box { flex: 1; margin-right: 1rem; }
      .search-box input { width: 100%; min-width: 50px; }
      
      /* Adjust Hero Card */
      .hero-card { 
        flex-direction: column; text-align: center; padding: 2rem; 
        gap: 1.5rem; align-items: center; 
      }
      .weather-icon-stage { transform: scale(0.9); } /* Shrink icon slightly */
      
      /* Adjust Metrics Grid */
      .grid-dashboard { gap: 1rem; }
      
      /* Fonts */
      .clock-time { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

  <div class="app-bg" id="app-bg"></div>
  <div class="app-noise"></div>

  <div class="app-container">
    <nav class="sidebar">
      <div class="nav-logo"><i class="ph-fill ph-planet"></i></div>
      <button class="nav-item active" onclick="switchTab('dashboard', this)">
        <i class="ph-bold ph-squares-four"></i>
      </button>
      <button class="nav-item" onclick="switchTab('wind', this)">
        <i class="ph-bold ph-wind"></i>
      </button>
      <button class="nav-item" onclick="switchTab('radar', this)">
        <i class="ph-bold ph-radar"></i>
      </button>
      <button class="nav-item" onclick="switchTab('astro', this)">
        <i class="ph-bold ph-sun-horizon"></i>
      </button>
      <div class="spacer" style="flex:1"></div>
      <button class="nav-item" onclick="switchTab('settings', this)">
        <i class="ph-bold ph-gear"></i>
      </button>
    </nav>

    <main class="main-content">
      
      <section id="view-dashboard" class="view-section active">
        <header class="view-header">
          <div class="view-title">
            <span>System Overview</span>
            <h1>Dashboard</h1>
          </div>
          <div class="header-right">
             <div class="search-box">
                <i class="ph-bold ph-magnifying-glass"></i>
                <input type="text" id="zip-search" placeholder="Zip Code..." onkeydown="handleSearch(event)">
             </div>
             <div class="clock-widget">
                <div class="clock-time" id="clock-time">--:--:--</div>
                <div class="clock-date" id="clock-date">--</div>
             </div>
          </div>
        </header>

        <div class="grid-dashboard">
          <div class="glass-card hero-card">
            <div>
              <div style="font-size:1.1rem; opacity:0.8; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; justify-content:center;">
                <i class="ph-fill ph-map-pin"></i> <span id="loc-name">Locating...</span>
              </div>
              <div id="val-temp">--°</div>
              <div style="color:var(--accent); margin-top:0.5rem; font-size:1.4rem; font-weight:600;" id="val-cond">--</div>
            </div>
            
            <div class="weather-icon-stage" id="icon-stage">
               <div class="glass-cloud"></div>
            </div>
          </div>

          <div class="glass-card">
            <div class="metric-label">Humidity</div>
            <div class="metric-val" id="val-humid">--%</div>
            <div class="metric-sub">Dew Point: <span id="val-dew">--</span>°</div>
          </div>
          <div class="glass-card">
            <div class="metric-label">Pressure</div>
            <div class="metric-val" id="val-press">--</div>
            <div class="metric-sub" style="font-size:1rem">hPa</div>
          </div>
          <div class="glass-card">
            <div class="metric-label">Visibility</div>
            <div class="metric-val" id="val-vis">--</div>
            <div class="metric-sub" style="font-size:1rem">Miles</div>
          </div>
        </div>
      </section>

      <section id="view-wind" class="view-section">
        <header class="view-header"><div class="view-title"><span>Simulation</span><h1>Live Ocean</h1></div></header>
        <div class="glass-card" style="padding:0; height:400px; position:relative; overflow:hidden;">
           <div class="ocean-scene" id="ocean-scene" style="height:100%; width:100%; border:none;">
              <div class="wave"></div><div class="wave"></div>
              <div style="position:absolute; bottom:-20px; right:20px; width:200px; animation: sway 3s ease-in-out infinite alternate;">
                 <svg viewBox="0 0 200 300" fill="none"><path d="M98 300C86 248 84 205 88 160C92 110 110 60 120 0" stroke="rgba(0,0,0,0.4)" stroke-width="10" stroke-linecap="round"/><path d="M118 22C150 30 180 52 196 78" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 35C145 55 165 78 178 105" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/><path d="M118 22C85 35 55 58 25 86" stroke="#0f172a" stroke-width="10" stroke-linecap="round"/><path d="M118 40C90 60 70 85 52 112" stroke="#0f172a" stroke-width="9" stroke-linecap="round"/></svg>
              </div>
              <div style="position:absolute; bottom:20px; left:20px; z-index:10;">
                 <div style="font-size:4rem; font-weight:800; line-height:1" id="wind-big">--</div>
                 <div style="font-weight:700; opacity:0.8; letter-spacing:2px">MPH WIND</div>
              </div>
           </div>
        </div>
      </section>

      <section id="view-radar" class="view-section">
        <header class="view-header"><div class="view-title"><span>Map</span><h1>Live Radar</h1></div></header>
        <div style="width:100%; height:60vh; border-radius:32px; overflow:hidden; border:1px solid var(--glass-border);" id="radar-container">
           <div style="height:100%; display:flex; align-items:center; justify-content:center;">Loading Radar...</div>
        </div>
      </section>

      <section id="view-astro" class="view-section">
         <header class="view-header"><div class="view-title"><span>Celestial</span><h1>Sun & Moon</h1></div></header>
         <div class="grid-dashboard">
            <div class="glass-card">
               <div class="metric-label">Sunrise</div>
               <div class="metric-val" id="val-rise">--</div>
            </div>
            <div class="glass-card">
               <div class="metric-label">Sunset</div>
               <div class="metric-val" id="val-set">--</div>
            </div>
         </div>
      </section>

    </main>
  </div>

  <script>
    // ===== STATE =====
    let lat = null, lon = null;
    const ui = {
      loc: document.getElementById('loc-name'),
      temp: document.getElementById('val-temp'),
      cond: document.getElementById('val-cond'),
      humid: document.getElementById('val-humid'),
      dew: document.getElementById('val-dew'),
      press: document.getElementById('val-press'),
      vis: document.getElementById('val-vis'),
      windBig: document.getElementById('wind-big'),
      radar: document.getElementById('radar-container'),
      iconStage: document.getElementById('icon-stage'),
      rise: document.getElementById('val-rise'),
      set: document.getElementById('val-set')
    };

    // ===== CLOCK =====
    function updateClock() {
        const now = new Date();
        document.getElementById('clock-time').textContent = now.toLocaleTimeString('en-US', {hour12: false});
        document.getElementById('clock-date').textContent = now.toLocaleDateString('en-US', {weekday:'short', month:'short', day:'numeric'});
    }
    setInterval(updateClock, 1000); updateClock();

    // ===== INIT =====
    function initApp() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (pos) => { lat = pos.coords.latitude; lon = pos.coords.longitude; fetchLocationName(lat, lon); },
          () => { console.warn("GPS Denied. IP Fallback."); getLocationByIP(); }
        );
      } else { getLocationByIP(); }
    }

    async function fetchLocationName(lat, lon) {
        try {
            // Uses BigDataCloud Free API for Reverse Geocoding (City, State)
            const res = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
            const data = await res.json();
            ui.loc.textContent = `${data.city}, ${data.principalSubdivisionCode}`;
            fetchWeather();
        } catch(e) { ui.loc.textContent = "Current Location"; fetchWeather(); }
    }

    async function getLocationByIP() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        lat = data.latitude; lon = data.longitude;
        ui.loc.textContent = `${data.city}, ${data.region_code}`;
        fetchWeather();
      } catch (e) { ui.loc.textContent = "Location Unknown"; }
    }

    async function handleSearch(e) {
        if(e.key === 'Enter') {
            const zip = document.getElementById('zip-search').value;
            // Placeholder: In real app, call API to convert Zip -> Lat/Lon
            alert("Searching DB for: " + zip);
        }
    }

    // ===== WEATHER FETCH =====
    async function fetchWeather() {
      if (!lat || !lon) return;
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relativehumidity_2m,visibility,pressure_msl,dewpoint_2m&daily=sunrise,sunset&windspeed_unit=mph&temperature_unit=fahrenheit&timezone=auto`;
      
      try {
        const res = await fetch(url);
        const data = await res.json();
        const curr = data.current_weather;
        
        ui.temp.textContent = Math.round(curr.temperature) + "°";
        ui.cond.textContent = getWeatherDesc(curr.weathercode);
        ui.windBig.textContent = Math.round(curr.windspeed);
        
        ui.humid.textContent = data.hourly.relativehumidity_2m[0] + "%";
        ui.dew.textContent = Math.round(data.hourly.dewpoint_2m[0]);
        ui.press.textContent = Math.round(data.hourly.pressure_msl[0]);
        ui.vis.textContent = (data.hourly.visibility[0] / 1609).toFixed(1);
        
        ui.rise.textContent = data.daily.sunrise[0].slice(-5);
        ui.set.textContent = data.daily.sunset[0].slice(-5);

        renderIcon(curr.weathercode, curr.is_day);
        
        // Load Radar
        ui.radar.innerHTML = `<iframe src="https://embed.windy.com/embed2.html?lat=${lat}&lon=${lon}&detailLat=${lat}&detailLon=${lon}&width=650&height=450&zoom=10&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1" width="100%" height="100%" frameborder="0"></iframe>`;

      } catch(e) { console.error(e); }
    }

    // ===== RENDER ICON & DESC =====
    function renderIcon(code, isDay) {
        const stage = ui.iconStage;
        let html = `<div class="glass-cloud"></div>`;
        
        if (code < 3) { // Sunny/Clear
            html += `<div class="sun-glare" style="opacity:${isDay?0.8:0.3}; background:${isDay?'radial-gradient(circle, #fbbf24 0%, transparent 70%)':'radial-gradient(circle, #f8fafc 0%, transparent 70%)'}"></div>`;
        }
        
        if (code > 50) { // Rain
            for(let i=0; i<5; i++) {
                html += `<div class="rain-drop" style="left:${20 + i*15}px; animation-delay:${i*0.2}s"></div>`;
            }
        }

        if (code >= 95) { // Storm
            html += `<div class="lightning-bolt bolt-anim"></div>`;
        }
        stage.innerHTML = html;
    }

    function getWeatherDesc(code) {
      if(code === 0) return "Clear Sky";
      if(code < 4) return "Partly Cloudy";
      if(code < 50) return "Foggy";
      if(code < 80) return "Rain";
      return "Thunderstorm";
    }

    function switchTab(id, btn) {
      document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
      document.getElementById('view-'+id).classList.add('active');
      document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
      btn.classList.add('active');
    }

    // Start App
    initApp();
  </script>
</body>
</html>
